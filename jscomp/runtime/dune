(library
 (public_name melange.js)
 (name js)
 (modes melange)
 (preprocess
  (pps melange.ppx -unsafe))
 (melange.compile_flags
  -nopervasives
  -nostdlib
  -bs-no-check-div-by-zero
  -bs-cross-module-opt
  -unsafe))

(rule
 (deps caml_io.cppo.ml)
 (target caml_io.ml)
 (action
  (with-stdout-to
   %{target}
   (run cppo %{env:CPPO_FLAGS=} %{deps} -o %{target}))))

(rule
 (target js_typed_array.ml)
 (deps js_typed_array.cppo.ml)
 (action
  (run cppo %{deps} -o %{target})))

(rule
 (target js_typed_array2.ml)
 (deps js_typed_array2.cppo.ml)
 (action
  (run cppo %{deps} -o %{target})))

(rule
 (target caml_oo_curry.ml)
 (deps gen/caml_oo_curry_gen.ml)
 (action
  (with-stdout-to
   %{target}
   (run ocaml %{deps}))))

(rule
 (target curry.ml)
 (deps gen/curry_gen.ml)
 (action
  (with-stdout-to
   %{target}
   (run ocaml %{deps}))))
